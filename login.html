<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estadísticas y Archivo Clínico</title>
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
  <link rel="icon" href="img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
      /* === RESET Y BASE === */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
  
      html, body {
        height: 100%;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: white;
        background: linear-gradient(135deg, #2c3e50, #4a6a85, #7dacbf);
      }
  
      /* === CONTENEDOR PRINCIPAL === */
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 1rem;
      }
  
      .glass {
        width: 100%;
        max-width: 420px;
        padding: 2.5rem;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.1);
/*         backdrop-filter: blur(0.10px);       */        
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.18);
        transition: all 0.5s ease;
        animation: breathe 4s infinite ease-in-out;
      }
      
      /* Definición de la animación de respiración */
      @keyframes breathe {
          0%, 100% {
              transform: scale(1);
              opacity: 0.8;
              /* ELIMINA ESTA LÍNEA: box-shadow: 0 0 20px rgba(255, 255, 255, 0.2); */
          }
          50% {
              transform: scale(1.02);
              opacity: 1;
              /* ELIMINA ESTA LÍNEA: box-shadow: 0 0 30px rgba(255, 255, 255, 0.4); */
          }
      }
  
      /* Estados del panel */
      .glass.loading { 
        background: rgba(0, 123, 255, 0.15); 
        box-shadow: 0 8px 32px rgba(0, 123, 255, 0.25); 
      }
      .glass.success { 
        background: rgba(40, 167, 69, 0.2); 
        box-shadow: 0 8px 32px rgba(40, 167, 69, 0.25); 
      }
      .glass.error { 
        background: rgba(240, 50, 60, 0.45);  /* Cambia 0.25 por 0.45 */
        box-shadow: 0 6px 20px rgba(240, 50, 60, 0.5);  /* Cambia 0.25 por 0.5 */
      }
  
      /* === HEADER === */
      .header {
        text-align: center;
        margin-bottom: 2rem;
      }
  
      .logo {
        display: block;
        margin: 0 auto 1rem;
      }
  
      .header h3 {
        font-weight: 400;
        font-size: 1.2rem;
        opacity: 0.9;
      }
  
      /* === FORMULARIO === */
      form {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }
  
      .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
  
      label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        opacity: 0.9;
      }
  
      input {
        padding: 0.8rem 1rem;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 1rem;
        transition: all 0.3s ease;
      }
  
      input:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.4);
        background: rgba(255, 255, 255, 0.15);
      }
  
      input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }
  
      /* === BOTONES === */
      .botones-vertical {
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
        margin-top: 1rem;
      }
  
      button {
        padding: 0.8rem;
        border-radius: 8px;
        border: none;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }
  
      button[type="submit"] {
        background: #4a90e2;
        color: white;
      }
  
      button[type="submit"]:hover {
        background: #3a7bc8;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
  
      button[type="reset"] {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }
  
      button[type="reset"]:hover {
        background: rgba(255, 255, 255, 0.2);
      }
  
      /* === MENSAJES === */
      #message {
      text-align: center;
      padding: 0.8rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      transition: all 0.5s ease; /* Agregar esta línea */
      }
  
      /* === FOOTER === */
      footer {
        text-align: center;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.8rem;
        opacity: 0.7;
      }
  
      /* === RESPONSIVE === */
      @media (max-width: 480px) {
        .glass {
          padding: 2rem 1.5rem;
        }
        
        .header h3 {
          font-size: 1.1rem;
        }
      }
    </style>
</head>
<body>
  <div class="glass">
    <div class="header">
      <img class="logo" src="img/logo-hrpv.png" alt="Logo" width="120">
      <h3>Estadísticas y Archivo Clínico</h3>
    </div>

    <div id="message"></div>

    <form id="formularioLogin">
      <div class="form-group">
        <label for="username"><i class="fas fa-user"></i> Usuario</label>
        <input type="text" id="username" name="username" placeholder="ej. j.ramirez" required>
      </div>
      
      <div class="form-group">
        <label for="password"><i class="fas fa-key"></i> Contraseña</label>
        <input type="password" id="password" name="password" placeholder="••••••••" required>
      </div>

      <div class="botones-vertical">
        <button type="submit"><i class="fas fa-sign-in-alt"></i> Iniciar sesión</button>
        <button type="reset"><i class="fas fa-broom"></i> Limpiar</button>
      </div>
    </form>

    <footer>
      <p id="footerText">Hecho con ❤️ por Ricardo · 2023</p>
    </footer>
  </div>

  <script>
    // ========== SISTEMA DE ESTADO Y "RESPIRACIÓN" ==========
    
    // Nivel de intensidad simbólica de la "respiración"
    let intensidadUso = 0;
    let respiracionInterval;

    // Inicia la respiración con animación optimizada
    function iniciarRespiracion() {
      const dashboard = document.querySelector('.glass');
      if (!dashboard) return;

      // Limpia animación previa
      clearInterval(respiracionInterval);

      let fase = 0;
      respiracionInterval = setInterval(() => {
        fase += 0.02;
        const intensidad = Math.min(0.15 + intensidadUso / 80, 0.4);
        const escala = 1 + Math.sin(fase) * intensidad * 0.02;
        dashboard.style.transform = `scale(${escala})`;
      }, 500);
    }

    // Cambia el estado visual del panel con transiciones suaves
    function setEstado(estado, mensaje = null) {
      const dashboard = document.querySelector('.glass');
      const messageDiv = document.getElementById('message');
      if (!dashboard) return;

      // Incrementa brevemente la "intensidad" para reflejar actividad
      intensidadUso = Math.min(intensidadUso + 1, 10);
      iniciarRespiracion();
      setTimeout(() => (intensidadUso = Math.max(intensidadUso - 1, 0)), 8000);

      // Transiciones más ligeras
      dashboard.style.transition = 'background 0.4s ease, box-shadow 0.6s ease, border 0.4s ease, transform 0.5s ease';
      dashboard.classList.remove('loading', 'success', 'error');

      switch (estado) {
        case 'loading':
          dashboard.classList.add('loading');
          break;
        case 'success':
          dashboard.classList.add('success');
          break;
        case 'error':
          dashboard.classList.add('error');
          break;
      }

      // Texto de estado con iconos suaves
      if (messageDiv) {
        const iconos = {
          loading: '<i class="fas fa-sync fa-spin"></i> Procesando...',
          success: '<i class="fas fa-check-circle"></i> Éxito ✅',
          error: '<i class="fas fa-exclamation-circle"></i> Error ❌'
        };
        messageDiv.innerHTML = mensaje || iconos[estado] || 'Listo';
        messageDiv.style.color = estado === 'error' ? '#f87171' : 'white';
        messageDiv.style.opacity = '1';
      }

      // Restaurar a cristalino después de unos segundos
      setTimeout(() => {
        dashboard.classList.remove('loading', 'success', 'error');
        dashboard.style.transition = 'background 2s ease, box-shadow 2s ease, border 2s ease, transform 0.5s ease';
      }, 5000);
    }

    // ========== LÓGICA DEL LOGIN ==========
    
    // Footer dinámico
    document.getElementById('footerText').innerHTML = 
      `Hecho con ❤️ por Ricardo · ${new Date().getFullYear()}`;

    // Lógica de login
    const form = document.getElementById('formularioLogin');
    const messageDiv = document.getElementById('message');
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbzVZm8UZhOJ8zhW9Go1WecPccbK7mnmx5gf8rHIrY1TPBBx3aJ838wpvBzLw0oQcdI-/exec';

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      setEstado('loading', 'Validando credenciales...');
      
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      try {
        const response = await fetch(scriptUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        const result = await response.json();

        if (result.success) {
          setEstado('success', `¡Acceso exitoso como ${result.role}! Redirigiendo...`);
          
          setTimeout(() => {
            if (result.role === 'admin') {
              window.location.href = 'admin.html';
            } else if (result.role === 'lector') {
              window.location.href = 'lector.html';
            } else {
              window.location.href = 'dashboard.html';
            }
          }, 1500);
        } else {
          setEstado('error', 'Usuario o contraseña incorrectos.');
        }

      } catch (error) {
        setEstado('error', 'Error al conectar. Verifica tu conexión.');
        console.error('Error:', error);
      }
    });

    // Iniciar respiración sutil al cargar la página
    window.addEventListener('load', () => {
      iniciarRespiracion();
    });
  </script>
</body>
</html>
